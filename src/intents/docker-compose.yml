services:
  intent_classifier:
    image: dialogcart-intent-classifier   # ðŸ‘ˆ use the image built in run.sh
    container_name: dialogcart-intent-classifier
    environment:
      - INTENT_CLASSIFIER_PORT=9000
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - PYTHONPATH=/app/src
      - OMP_NUM_THREADS=2
      - MKL_NUM_THREADS=2
      - TF_CPP_MIN_LOG_LEVEL=2
      - RASA_TELEMETRY_ENABLED=false
      - SQLALCHEMY_SILENCE_UBER_WARNING=1
    ports:
      - "9000:9000"
    volumes:
      - ./trainings/storage:/app/storage
      - ./:/app/src/intents
    deploy:
      resources:
        limits:
          memory: 8g
        reservations:
          memory: 2g

  meilisearch:
    image: getmeili/meilisearch:v1.21.0
    container_name: dialogcart-meilisearch
    ports:
      - "7700:7700"
    environment:
      - MEILI_ENV=development
      - MEILI_NO_ANALYTICS=true
    volumes:
      - meilisearch_data:/meili_data
    restart: unless-stopped

  rasa_nlu:
    image: rasa/rasa:3.6.20-full
    container_name: dialogcart-rasa-nlu
    command: ["run", "--enable-api", "--port", "5005", "--cors", "*"]
    environment:
      - RASA_TELEMETRY_ENABLED=false
      - TF_CPP_MIN_LOG_LEVEL=2
    ports:
      - "5005:5005"
    volumes:
      - ./intents/semantics/rasa:/app
      - ./intents/semantics/rasa/models:/app/models
    working_dir: /app
    restart: unless-stopped

volumes:
  meilisearch_data: