version: "3.1"

language: en

pipeline:
- name: "normalization.normalizer.SimpleTextNormalizer"
  config_file: "/app/src/intents/trainings/normalization/normalization.yml"
  lowercase: true
  max_replacements_per_text: 50

- name: "debug.entity_logger.SimpleEntityLogger"
  label: "pre-tokenize"
  show_text: true
  show_intent: true
  show_entities: true
  log_level: "INFO"

# ✅ Add SpacyNLP first (this is what DIET + SpacyTokenizer depend on)
- name: SpacyNLP
  model: "en_core_web_md"   # use en_core_web_md if available in your image
  case_sensitive: false

- name: SpacyTokenizer

- name: RegexFeaturizer

# ✅ Use regex only for structured entities, not products
- name: RegexEntityExtractor
  use_lookup_tables: true
  use_regexes: true
  use_word_boundaries: true
  case_sensitive: false
  entity_types:
    - unit
    - container
    - symbol

- name: "debug.entity_logger.SimpleEntityLogger"
  label: "post-regex"
  show_intent: true
  show_entities: true
  log_level: "INFO"

- name: LexicalSyntacticFeaturizer

# ✅ SpaCy embeddings help with real words, not fabrications
- name: SpacyFeaturizer

# ✅ Word-level features
- name: CountVectorsFeaturizer
  analyzer: word
  min_ngram: 1
  max_ngram: 4

# ✅ Character n-gram features (critical for made-up words like kinto, panko)
- name: CountVectorsFeaturizer
  analyzer: char_wb
  min_ngram: 3
  max_ngram: 5

# ✅ DIET handles product extraction with support for OOVs
- name: DIETClassifier
  epochs: 200
  entity_recognition: true
  BILOU_flag: true
  random_seed: 42
  dropout: 0.1
  learning_rate: 0.001
  batch_size: 16
  use_sparse_input_dropout: true
  use_dense_input_dropout: true
  constrain_similarities: true
  evaluate_on_num_examples: 0
  evaluate_every_num_epochs: 0

- name: "debug.entity_logger.SimpleEntityLogger"
  label: "post-diet"
  show_intent: true
  show_entities: true
  log_level: "INFO"

- name: EntitySynonymMapper

- name: "debug.entity_logger.SimpleEntityLogger"
  label: "post-synonyms"
  show_intent: true
  show_entities: true
  log_level: "INFO"

- name: ResponseSelector
  epochs: 100

assistant_id: 20250912-093611-natural-dado
